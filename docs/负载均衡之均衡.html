<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>负载均衡之均衡 - Laumy的技术栈</title>
    <link rel="stylesheet" href="../../assets/style.css">
    <!-- MathJax支持LaTeX数学公式 -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="../../">Laumy的技术栈</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="输入关键词回车搜索">
        </div>
        <div class="theme-toggle" title="切换主题" id="theme-toggle">☾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="../../">首页</a></div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">文章目录</div>
          <nav id="toc"><ul><li><a href="#_1">何时均衡</a><ul></ul></li><li><a href="#laod-balance">laod balance</a><ul></ul></li><li><a href="#_2">负载均衡总结</a><ul></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>负载均衡之均衡</h1>
  <div class="meta">2023-04-22 · linux</div>
  <div class="post-content"><h2 id="_1">何时均衡</h2>
<p>在linux内核中，有一些场景会触发任务均衡的分布在系统的各个cpu上，可以分为以下几个场景：</p>
<ul>
<li>任务放置：task placement，fork创建的任务、sched_exec的任务或者阻塞被唤醒的任务，这些任务加入就绪队列时，可以确定放置任务到那个cpu上。</li>
<li>主动均衡：active upmigration，一个低算力的cpu无法运行某个重载任务时（misfit task），可以主动将misfit task向上迁移到算力更高的cpu上。</li>
<li>周期均衡：tick load balance，周期性的触发均衡。</li>
<li>new idle均衡：new idle load balance，调度器在选择下一个任务时，发现cfs 就绪队列中没有可运行任务，只能指向idle任务，进入idle状态会触发负载均衡。</li>
<li>nohz idle均衡：某个cpu任务太重，而其他cpu都进入idle，这时候任务重cpu会唤醒idle的cpu进行均衡负载。</li>
</ul>
<h2 id="laod-balance">laod balance</h2>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_a5dc98e9783e5cd283b2fd0214c642df.jpg"><img alt="" src="assets/doc/01-linux/进程调度/10-负载均衡之均衡/images/wp_editor_md_a5dc98e9783e5cd283b2fd0214c642df.jpg"/></a></p>
<p>（1）找出最繁忙的调度组 （2）在最繁忙调度组范围CPU找出最繁忙的CPU （3）从最繁忙的CPU就绪队列中出队任务 （4）将出队的任务挂到当前的cpu上。</p>
<h2 id="_2">负载均衡总结</h2>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_8d2b14ab4c163f226ca321020ed06086.jpg"><img alt="" src="assets/doc/01-linux/进程调度/10-负载均衡之均衡/images/wp_editor_md_8d2b14ab4c163f226ca321020ed06086.jpg"/></a></p>
<p>图来自窝蜗科技</p>
<p>PELT的缺陷： （1）算法迟钝，负载的变化需要一定的时间，在一些嵌入式场景如手机，在浏览网页等情况下，需要迅速识别重活来提高CPU频率或者迁移任务，保证手机流程型。 （2）对于睡眠或阻塞的进程，PELT还会继续计算其衰减负载，这些继续贡献的负载对于下一次唤醒没有实际用处，会推迟降低cpu频率的速度，导致功耗升高。</p>
<p>参考文献</p>
<p>1.蜗窝科技：http://www.wowotech.net/ 2.奔跑吧linux内核卷1基础架构</p></div>
  <div class="post-nav">
    <a class="prev" href="../../文件系统基本概念.html">← 文件系统基本概念</a>
    <a class="next" href="../../负载均衡之调度组和调度域.html">负载均衡之调度组和调度域 →</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright ©2022-2025 laumy 版权所有</div>
    </footer>

    <script src="../../assets/site.js"></script>
  </body>
  </html>

