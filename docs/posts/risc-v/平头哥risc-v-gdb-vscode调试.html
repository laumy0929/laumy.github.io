<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>平头哥RISC-V+gdb+vscode调试 - Laumy的技术栈</title>
    <link rel="stylesheet" href="/note_page/assets/style.css">
    <!-- MathJax支持LaTeX数学公式 -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="/note_page/">Laumy的技术栈</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="输入关键词回车搜索">
        </div>
        <div class="theme-toggle" title="切换主题" id="theme-toggle">☾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="/note_page/">首页</a></div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">文章目录</div>
          <nav id="toc"><ul><li><a href="#_1">工具准备</a><ul></ul></li><li><a href="#t-headdebugserver">T-headDebugServer工具</a><ul></ul></li><li><a href="#mobarxt-headdebuger-gdb">mobarX远程服务器代码与本地T-HeadDebuger GDB调试</a><ul><li><a href="#t-headdebugserver_1">设置T-HeadDebugServer监听端口</a></li><li><a href="#mobaxterm">设置mobaXterm</a></li><li><a href="#gdb">gdb连接</a></li></ul></li><li><a href="#vscodegdb">vscode+gdb调试</a><ul><li><a href="#remote-ssh">安装Remote-SSH</a></li><li><a href="#ssh">ssh连接服务器</a></li><li><a href="#_2">错误解决</a></li><li><a href="#gdb_1">gdb连接</a></li><li><a href="#_3">常用技巧</a></li></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>平头哥RISC-V+gdb+vscode调试</h1>
  <div class="meta">2024-05-07 · risc-v</div>
  <div class="post-content"><h2 id="_1">工具准备</h2>
<ul>
<li>T-HeadDebugServer工具：<a href="https://www.xrvm.cn/community/download?id=4238019891233361920">https://www.xrvm.cn/community/download?id=4238019891233361920</a></li>
<li>T-HeadDebugServer使用说明：<a href="https://www.xrvm.cn/community/download?id=4170589434888130560">https://www.xrvm.cn/community/download?id=4170589434888130560</a></li>
<li>vscode下载：<a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a></li>
<li>cklink：硬件调试器（网上购买）</li>
</ul>
<p>安装完成工具后，硬件平台要使能调试模式，一般是GPIO的复用要打开为JTAG模式。</p>
<h2 id="t-headdebugserver">T-headDebugServer工具</h2>
<p>安装好T-headDebugServer以及对应的cklink驱动后，并且使能了硬件平台的gpio复用为jtag，打开T-headDebugServer即可链接上硬件平台。如下图所示，表示连接成功。</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_c3f838b6069cbf2b18e89b74313be139.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_c3f838b6069cbf2b18e89b74313be139.jpg"/></a></p>
<p>如果连接不成功，可以修改下配置，再进行尝试。</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_ba0570bedb8e45fe721623de764c29ee.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_ba0570bedb8e45fe721623de764c29ee.jpg"/></a></p>
<h2 id="mobarxt-headdebuger-gdb">mobarX远程服务器代码与本地T-HeadDebuger GDB调试</h2>
<h3 id="t-headdebugserver_1">设置T-HeadDebugServer监听端口</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_deb29bf45f39ceeb5baeac473becdfa1.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_deb29bf45f39ceeb5baeac473becdfa1.jpg"/></a></p>
<p>设置好监听端口后启动</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_a889a57cb6c6621c42f99552a9108f69.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_a889a57cb6c6621c42f99552a9108f69.jpg"/></a></p>
<h3 id="mobaxterm">设置mobaXterm</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_8843fd0b2b28d3ffd639381f2c517c58.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_8843fd0b2b28d3ffd639381f2c517c58.jpg"/></a></p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_4411bab38ba2b1b4194bd648a035311d.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_4411bab38ba2b1b4194bd648a035311d.jpg"/></a></p>
<p>启动代理连接，有可能要输入ssh访问远程服务的账号和密码</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_644da20fa48c51108c271b549cc52ad9.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_644da20fa48c51108c271b549cc52ad9.jpg"/></a></p>
<h3 id="gdb">gdb连接</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_9c50b8a702bac7c0757fc67e3c7f01e4.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_9c50b8a702bac7c0757fc67e3c7f01e4.jpg"/></a></p>
<p>如果架构相关不正确，可使用set architecture riscv:rv64来设置。 为了便捷快速连接，也可以将常用的指令设置到.gdbinit脚本中。</p>
<h2 id="vscodegdb">vscode+gdb调试</h2>
<p>如果不习惯mobarXiterm上gdb命令行方式调试，可以使用vscode搭建gdb的调试环境，下面介绍vscode的gdb调试方法，前置条件为设置好mobarXiterm的代理。</p>
<h3 id="remote-ssh">安装Remote-SSH</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_291fb045fea72f2c683c0ad49782e12d.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_291fb045fea72f2c683c0ad49782e12d.jpg"/></a></p>
<h3 id="ssh">ssh连接服务器</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_aec6c49cc431dfa327f7d6c313f24e87.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_aec6c49cc431dfa327f7d6c313f24e87.jpg"/></a></p>
<h3 id="_2">错误解决</h3>
<h4 id="could-not-establish-connetion-to-xxxx">Could not establish connetion to xxxx</h4>
<p>如果报下面的错误</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_eb3d6925b915465fdbc2fac5fae4294e.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_eb3d6925b915465fdbc2fac5fae4294e.jpg"/></a></p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_c2b0ba6d649cb2a936d5cde4099af758.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_c2b0ba6d649cb2a936d5cde4099af758.jpg"/></a></p>
<p>则进行配置remote-SSH,右键-&gt;Extension Setting</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_333d34d55277af3308e5ef94b2c2a4f5.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_333d34d55277af3308e5ef94b2c2a4f5.jpg"/></a></p>
<p>参考：<a href="https://blog.csdn.net/qq_41854763/article/details/103317116">https://blog.csdn.net/qq_41854763/article/details/103317116</a></p>
<h4 id="xhr-failedscode">XHR failedscode</h4>
<p>参考：<a href="https://blog.csdn.net/m0_38040006/article/details/126752751">https://blog.csdn.net/m0_38040006/article/details/126752751</a></p>
<h3 id="gdb_1">gdb连接</h3>
<p>创建一个lauch.json</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_44382ab7e7d9da437c00ef0a66fb9556.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_44382ab7e7d9da437c00ef0a66fb9556.jpg"/></a></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="c1">// Use IntelliSense to learn about possible attributes.</span>
<span class="w">    </span><span class="c1">// Hover to view descriptions of existing attributes.</span>
<span class="w">    </span><span class="c1">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span>
<span class="w">    </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.2.0"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(gdb) Launch"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cppdbg"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"launch"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"program"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}/xxx/img/rt_system.elf"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">            </span><span class="nt">"stopAtEntry"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"cwd"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${fileDirname}"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"environment"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">            </span><span class="nt">"externalConsole"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"MIMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gdb"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"miDebuggerPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}/xxx/riscv64-elf-x86_64-20201104/bin/riscv64-unknown-elf-gdb"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"miDebuggerServerAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"localhost:8193"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"setupCommands"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enable pretty-printing for gdb"</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"set remotetimeout 20"</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">"ignoreFailures"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>修改好elf、gdb的位置，然后再设置好mobarXiterm的代理端口，这样就可以启动连接了。</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_e3319a14ea4d1a272bb553bb1ffe898a.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_e3319a14ea4d1a272bb553bb1ffe898a.jpg"/></a></p>
<h3 id="_3">常用技巧</h3>
<h4 id="_4">在汇编代码中支持打断点</h4>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_fbbc6e5ac43d2bb1637b4baae0c97527.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_fbbc6e5ac43d2bb1637b4baae0c97527.jpg"/></a></p>
<h4 id="ctrl">ctrl+鼠标左键生效</h4>
<p>先安装拓展插件 <a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_1d12c9f52434d85afa719564c1b1fc55.jpg"><img alt="" src="/note_page/assets/doc/02-risc-v/平头哥risc-vgdbvscode调试/images/wp_editor_md_1d12c9f52434d85afa719564c1b1fc55.jpg"/></a></p>
<p>进入VScode的首选项，选择设置（快捷键 Ctrl + , )，输入Go to definition，找到如下两个设置。 Editor: Multi Cursor Modifier 设置成 alt “editor.gotoLocation.multipleDefinitions” 设置成 “goto”。</p>
<p>重启vscode</p>
<h4 id="vscode">在vscode中实时显示汇编</h4>
<p>在代码处右键-&gt;Open Disassembly View。</p></div>
  <div class="post-nav">
    <a class="prev" href="/note_page/posts/risc-v/平头哥e90x中断处理汇编部分.html">← 平头哥E90X中断处理汇编部分</a>
    <a class="next" href="/note_page/posts/risc-v/risc-v指令集架构.html">RISC-V指令集架构 →</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright ©2022-2025 laumy 版权所有</div>
    </footer>

    <script src="/note_page/assets/site.js"></script>
  </body>
  </html>

