<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>文件系统基本概念 - Laumy的技术栈</title>
    <link rel="stylesheet" href="/note_page/assets/style.css">
    <!-- MathJax支持LaTeX数学公式 -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="/note_page/">Laumy的技术栈</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="输入关键词回车搜索">
        </div>
        <div class="theme-toggle" title="切换主题" id="theme-toggle">☾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="/note_page/">首页</a></div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">文章目录</div>
          <nav id="toc"><ul><li><a href="#_1">扇区与簇</a><ul></ul></li><li><a href="#_2">什么是文件系统</a><ul></ul></li><li><a href="#_3">常见的文件系统</a><ul></ul></li><li><a href="#_4">文件系统使用</a><ul><li><a href="#_5">文件内容的访问</a></li><li><a href="#_6">格式化文件系统与挂载</a></li></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>文件系统基本概念</h1>
  <div class="meta">2023-05-13 · linux</div>
  <div class="post-content"><p>mount的机制是如何实现的？ inode是如何分配的。磁盘inode和内存inode有什么区别？ dentry缓存是怎么回事？如何管理？ free命令中Cache和buff有什么区别？Page cache了？如何管理文件数据缓存？</p>
<h2 id="_1">扇区与簇</h2>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_a2aa4567ad1f5c58340fe7fbb6b16f0d.jpg"><img alt="" src="/note_page/assets/doc/01-linux/文件系统/文件系统基本概念/images/wp_editor_md_a2aa4567ad1f5c58340fe7fbb6b16f0d.jpg"/></a></p>
<p>物理块和扇区，逻辑块和簇是相同概念。扇区（物理块）是磁盘最小的存储单元，磁头从磁盘读取数据的最小单元，一般是512B，即磁头每次从磁盘读取数据，都是一个扇区一个扇区读写。但对于操作系统来说无法对数目众多的扇区进行寻址，所以操作系统对磁盘的操作是以多个扇区组成形成一个簇为单位。 物理块/扇区是对磁盘操作而言的；逻辑块/簇是对软件操作系统（或文件系统）而言的，在linux中称为块，在windows中称为簇，操作系统从磁盘中拿一块数据，即完成一次磁盘IO。 块的大小在磁盘格式化时被指定，一般有1K/2K/4K，如果块的大小设置为4K，那么磁盘要读取8个扇区之后才将数据给操作系统。如果一个文件的大小是1K，而块的大小是4K，那么文件也会占用一个块的大小，剩余3K将会被空闲处理。</p>
<h2 id="_2">什么是文件系统</h2>
<p>文件系统是一个控制数据存取的软件系统，实现文件的增、删、查、改等操作。文件系统是可以构建在磁盘（flash、SD卡、SSD等），也可以构建在网络或内存上，甚至可以构建在一个文件上。文件系统更重要的功能是抽象了一个更加容易访问的存储空间接口，这些接口包括对于程序开发的API和用户的操作等。</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_a96950e0189578382028eca8f6877ef9.jpg"><img alt="" src="/note_page/assets/doc/01-linux/文件系统/文件系统基本概念/images/wp_editor_md_a96950e0189578382028eca8f6877ef9.jpg"/></a></p>
<p>底层是具体的硬件设备，硬件设备是具备存储功能的介质包括磁盘、内存、网络、甚至文件。中间层是操作系统将存储介质抽象为一个连续的线性空间，线性空间可分为大小相同的块（1KB、2KB、4KB等），抽象为连续的线性空间主要是便于顶层的文件系统管理。顶层就是文件系统，文件系统对线性空间进行管理和抽象，便于用户进行操作，文件系统一般呈现为目录树，这里的层级结构就是平常的目录、子目录和文件等元素的集合。</p>
<ul>
<li>目录：是一种容器，可以容纳子目录和普通文件，通过目录来对文件进行分类，便于用户访问，在linux中目录也是文件。</li>
<li>文件：是文件系统中存储数据的实体，文件有文件名，用于标识一个文件，文件的种类很多如txt、mp3、doc等，不同的文件类型需要对应于的应用来打开。具体文件可以分为普通文件、字符设备文件、块设备文件、套接字文件。</li>
<li>链接：分为软链接和硬链接；软链接是文件的另一种形态，其内容指向另外一个文件的路径，软链接也称为符号链接。硬链接则不同，是一个已存在文件的附加名称，在目录中增加了一项，但是其内容与源文件内容完全相同。</li>
</ul>
<p>在linux系统中一切都是文件，可以使用ls -l通过显示结果查看文件类型。</p>
<h2 id="_3">常见的文件系统</h2>
<ul>
<li>本地文件系统：实现对磁盘的管理，常用的用EXT4、FAT、XFS、ZFS等</li>
<li>伪文件系统：不是持久化的数据，对应内存的文件系统，便于用于以文件的形式与内核数据交互，如proc、sysfs、configfs、debugfs等。</li>
<li>网络文件系统：基于tcp/ip协议的文件系统，运行具有网络的计算机访问另外一具有网络的计算机像访问本地文件系统一样。</li>
</ul>
<h2 id="_4">文件系统使用</h2>
<h3 id="_5">文件内容的访问</h3>
<p>对于普通用户来说，通过命令或鼠标就能对文件进行操作，对于程序员来说可以通过API接口来进行完成，下面是举例常用接口。</p>
<table>
<thead>
<tr>
<th style="text-align: center;">API</th>
<th style="text-align: center;">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">open</td>
<td style="text-align: center;">打开文件</td>
</tr>
<tr>
<td style="text-align: center;">read</td>
<td style="text-align: center;">从文件读数据</td>
</tr>
<tr>
<td style="text-align: center;">write</td>
<td style="text-align: center;">从文件写数据</td>
</tr>
<tr>
<td style="text-align: center;">close</td>
<td style="text-align: center;">关闭文件</td>
</tr>
<tr>
<td style="text-align: center;">lseek</td>
<td style="text-align: center;">移动文件指针位置</td>
</tr>
<tr>
<td style="text-align: center;">lseek</td>
<td style="text-align: center;">删除文件</td>
</tr>
</tbody>
</table>
<h3 id="_6">格式化文件系统与挂载</h3>
<p>格式化文件系统是在一个存储设备上构建一个文件系统，而挂载则是将文件系统激活在文件系统的目录树中可以进行访问。 （1）文件系统的构建命令</p>
<div class="codehilite"><pre><span></span><code><span class="n">mkfs</span><span class="p">.</span><span class="n">xxx</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">xxx</span>

<span class="n">如mkfs</span><span class="p">.</span><span class="n">ext4</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb</span><span class="err">，</span><span class="w"> </span><span class="n">将块设备格式化为ext4文件系统</span>
</code></pre></div>
<p>（2）文件系统挂载 文件系统只有挂载到系统中，才可以进行访问。</p>
<div class="codehilite"><pre><span></span><code><span class="n">mount</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="p">[</span><span class="n">fs</span><span class="w"> </span><span class="n">type</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="p">[</span><span class="n">opt</span><span class="p">]</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">dir</span>
<span class="n">如mount</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="n">ext4</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">ext4</span>
</code></pre></div>
<p>除了手动挂载文件系统，linux还支持自动挂载，通过配置fstab配置文件即可进行挂载对应的设备。</p>
<div class="codehilite"><pre><span></span><code><span class="n">proc</span><span class="w">       </span><span class="o">/</span><span class="n">proc</span><span class="w">       </span><span class="n">proc</span><span class="w">        </span><span class="n">defaults</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>
<span class="n">sysfs</span><span class="w">      </span><span class="o">/</span><span class="n">sys</span><span class="w">        </span><span class="n">sysfs</span><span class="w">       </span><span class="n">defaults</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span>
<span class="n">devtmpfs</span><span class="w">   </span><span class="o">/</span><span class="n">dev</span><span class="w">        </span><span class="n">devtmpfs</span><span class="w">    </span><span class="n">defaults</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span>
<span class="n">tmpfs</span><span class="w">      </span><span class="o">/</span><span class="n">tmp</span><span class="w">        </span><span class="n">tmpfs</span><span class="w">       </span><span class="n">defaults</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>
<span class="n">tmpfs</span><span class="w">      </span><span class="o">/</span><span class="n">var</span><span class="w">        </span><span class="n">tmpfs</span><span class="w">       </span><span class="n">defaults</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span>
</code></pre></div>
<p>还可以基于文件来构建文件系统，下面是示例：</p>
<div class="codehilite"><pre><span></span><code><span class="cp"># 1生成一个全0的二进制文件</span>

<span class="n">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">zero</span><span class="w"> </span><span class="n">of</span><span class="o">=</span><span class="n">ext4</span><span class="p">.</span><span class="n">bin</span><span class="w"> </span><span class="n">bs</span><span class="o">=</span><span class="mi">1</span><span class="n">M</span><span class="w"> </span><span class="n">count</span><span class="o">=</span><span class="mi">100</span>

<span class="cp">#2 格式化为EXT4文件系统</span>

<span class="n">mkfs</span><span class="p">.</span><span class="n">ext4</span><span class="w"> </span><span class="n">ext4</span><span class="p">.</span><span class="n">bin</span>

<span class="cp">#3 使用loop设备，访问块设备,需要在内核把CONFIG_BLK_DEV_LOOP打开。</span>

<span class="n">losetup</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop0</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">ext4</span><span class="p">.</span><span class="n">bin</span>

<span class="cp">#4 挂载文件系统</span>
<span class="n">mkdir</span><span class="w"> </span><span class="n">ext4</span>
<span class="n">mount</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop10</span><span class="w"> </span><span class="n">ext4</span>
</code></pre></div>
<p>文件系统的目录下可以挂载其他文件系统。</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_659b9b697207afbd165de3ae7a4cb339.jpg"><img alt="" src="/note_page/assets/doc/01-linux/文件系统/文件系统基本概念/images/wp_editor_md_659b9b697207afbd165de3ae7a4cb339.jpg"/></a></p></div>
  <div class="post-nav">
    <a class="prev" href="/note_page/posts/linux/文件系统磁盘管理.html">← 文件系统磁盘管理</a>
    <a class="next" href="/note_page/posts/linux/负载均衡之均衡.html">负载均衡之均衡 →</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright ©2022-2025 laumy 版权所有</div>
    </footer>

    <script src="/note_page/assets/site.js"></script>
  </body>
  </html>

